<!doctype html><html lang=ja-jp><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.90.1">
<link rel=apple-touch-icon sizes=57x57 href=/note/ico/apple-icon-57x57.png>
<link rel=apple-touch-icon sizes=60x60 href=/note/ico/apple-icon-60x60.png>
<link rel=apple-touch-icon sizes=72x72 href=/note/ico/apple-icon-72x72.png>
<link rel=apple-touch-icon sizes=76x76 href=/note/ico/apple-icon-76x76.png>
<link rel=apple-touch-icon sizes=114x114 href=/note/ico/apple-icon-114x114.png>
<link rel=apple-touch-icon sizes=120x120 href=/note/ico/apple-icon-120x120.png>
<link rel=apple-touch-icon sizes=144x144 href=/note/ico/apple-icon-144x144.png>
<link rel=apple-touch-icon sizes=152x152 href=/note/ico/apple-icon-152x152.png>
<link rel=apple-touch-icon sizes=180x180 href=/note/ico/apple-icon-180x180.png>
<link rel=icon type=image/png sizes=192x192 href=/note/ico/android-icon-192x192.png>
<link rel=icon type=image/png sizes=32x32 href=/note/ico/favicon-32x32.png>
<link rel=icon type=image/png sizes=96x96 href=/note/ico/favicon-96x96.png>
<link rel=icon type=image/png sizes=16x16 href=/note/ico/favicon-16x16.png>
<link rel=manifest href=/note/ico/manifest.json>
<meta name=msapplication-TileColor content="#ffffff">
<meta name=msapplication-TileImage content="/note/ico/ms-icon-144x144.png">
<meta name=theme-color content="#ffffff">
<title>Firebase local emulatorのfirestoreのデータインポート／エクスポートについてのメモ | 山田航空ネットワーク3rd</title>
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://yamacraft.github.io/note/image/ogp.png">
<meta name=twitter:title content="Firebase local emulatorのfirestoreのデータインポート／エクスポートについてのメモ">
<meta name=twitter:description content="現在のFirebase local emulatorのデータをエクスポートする Firebase local emulatorが起動中の状態で、 firebase emulators:export コマンドを呼び出すことで、データ">
<meta property="og:title" content="Firebase local emulatorのfirestoreのデータインポート／エクスポートについてのメモ">
<meta property="og:description" content="現在のFirebase local emulatorのデータをエクスポートする Firebase local emulatorが起動中の状態で、 firebase emulators:export コマンドを呼び出すことで、データ">
<meta property="og:type" content="article">
<meta property="og:url" content="https://yamacraft.github.io/note/how-to-firebase-emulator-import-export/"><meta property="og:image" content="https://yamacraft.github.io/note/image/ogp.png"><meta property="article:section" content>
<meta property="article:published_time" content="2021-05-10T18:00:00+09:00">
<meta property="article:modified_time" content="2021-05-10T18:00:00+09:00">
<link href=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css rel=stylesheet integrity=sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T crossorigin=anonymous>
<link rel=stylesheet href=https://use.fontawesome.com/releases/v5.0.13/css/all.css integrity=sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp crossorigin=anonymous>
<link href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i" rel=stylesheet>
<link href=/note/css/medium.css rel=stylesheet>
<link href=/note/css/additional.css rel=stylesheet>
<link type=text/css rel=stylesheet href=https://yamacraft.github.io/note/css/note.css>
</head>
<body>
<div class=site-content-custom>
<div class=container>
<div class=mainheading>
<a href=https://yamacraft.github.io/note/>
<h1 class=sitetitle>山田航空ネットワーク3rd</h1>
</a>
<p class=lead>
<a href=https://twitter.com/yamacraft>@yamacraft</a>の雑記。感想は直接お伝えください。<br>
記事フィルタはこちら → <a href=/note/tags/tech/>tech</a> / <a href=/note/tags/work/>work</a> / <a href=/note/tags/diary/>diary</a> / <a href=/note/tags/poem/>poem</a> / <a href=/note/tags/yodan/>yodan</a>
</p>
</div><div class=main-content>
<div class=container>
<div class=row>
<div class="col-md-2 pl-0"><div class="share sticky-top sticky-top-offset">
<p>Share</p>
<ul>
<li class="ml-1 mr-1">
<a target=_blank href="https://twitter.com/intent/tweet?text=Firebase%20local%20emulator%e3%81%aefirestore%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e3%82%a4%e3%83%b3%e3%83%9d%e3%83%bc%e3%83%88%ef%bc%8f%e3%82%a8%e3%82%af%e3%82%b9%e3%83%9d%e3%83%bc%e3%83%88%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6%e3%81%ae%e3%83%a1%e3%83%a2 - %e5%b1%b1%e7%94%b0%e8%88%aa%e7%a9%ba%e3%83%8d%e3%83%83%e3%83%88%e3%83%af%e3%83%bc%e3%82%af3rd&url=https%3a%2f%2fyamacraft.github.io%2fnote%2fhow-to-firebase-emulator-import-export%2f" onclick="return window.open(this.href,'twitter-share','width=550,height=435'),!1">
<i class="fab fa-twitter"></i>
</a>
</li>
<li class="ml-1 mr-1">
<a target=_blank href="https://facebook.com/sharer.php?u=https%3a%2f%2fyamacraft.github.io%2fnote%2fhow-to-firebase-emulator-import-export%2f" onclick="return window.open(this.href,'facebook-share','width=550,height=435'),!1">
<i class="fab fa-facebook-f"></i>
</a>
</li>
</ul>
</div>
</div>
<div class="col-md-9 flex-first flex-md-unordered">
<div class=mainheading>
<span class=post-date>May 10, 2021 - 3 min read</span>
<h1 class=posttitle>Firebase local emulatorのfirestoreのデータインポート／エクスポートについてのメモ</h1>
<div class=after-post-tags>
<ul class=tags>
<li>
<a href=/note/tags/tech>tech</a>&ensp;
</li>
<li>
<a href=/note/tags/firebase>firebase</a>&ensp;
</li>
</ul>
</div>
</div>
<div class=article-post>
<h2 id=現在のfirebase-local-emulatorのデータをエクスポートする>現在のFirebase local emulatorのデータをエクスポートする</h2>
<p>Firebase local emulatorが起動中の状態で、 <code>firebase emulators:export</code> コマンドを呼び出すことで、データをエクスポートできます。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ firebase emulators:export export-path
</code></pre></div><p><code>export-path</code> 先に、現在のemulatorの内容がエクスポートされます。
<code>--only firestore</code> のオプションを付けることで、firestoreのデータだけをエクスポートできます。</p>
<h2 id=既存のfirebaseプロジェクトからデータをエクスポートする>既存のFirebaseプロジェクトからデータをエクスポートする</h2>
<p>既存のFirebaseプロジェクトのfirestoreのデータをエクスポートする方法もあります。
Firebase CLIとGoogle Cloud SDKとFirebase Storageを利用します。</p>
<p>詳細は次の記事に詳しく書かれています。
ここは日本語で手っ取り早く内容を知りたい人向けに書きます。</p>
<p><a href=https://medium.com/firebase-developers/how-to-import-production-data-from-cloud-firestore-to-the-local-emulator-e82ae1c6ed8>How to Import Production Data From Cloud Firestore to the Local Emulator | Firebase Developers</a></p>
<p>なお、エクスポートする対象のFirebaseプロジェクトが従量課金プランになっている必要があります。
無料プランの場合パーミッションエラーになります。</p>
<h3 id=firebaseとgcloudの認証とプロジェクト設定を行う>firebaseとgcloudの認証とプロジェクト設定を行う</h3>
<p>gcloudの認証ユーザーは、対象のFirebaseプロジェクトのオーナーアカウントを選択してください。
少なくとも編集者ユーザーでは、この後のStorageバックアップがパーミッションエラーで失敗します。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ firebase login
$ gcloud auth login

$ firebase use your-project-id
$ gcloud config set project your-project-id
</code></pre></div><p><code>your-project-id</code> は、プロジェクト名ではなくプロジェクトIDなので注意してください。</p>
<h3 id=storageにデータをエクスポートする>Storageにデータをエクスポートする</h3>
<p><code>gcloud firestore export</code> コマンドを使って、firestoreのデータをStorageにエクスポートします。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ gcloud firestore export gs://your-project-id.appspot.com/folder-name
</code></pre></div><p>成功すると、対象のFirebaseプロジェクトのStorageの <code>folder-name</code> 以下にデータがエクスポートされます。
<code>folder-name</code> のフォルダはなければ勝手に作ってくれるので安心してください。</p>
<h3 id=ローカルにstorageのデータをダウンロードする>ローカルにStorageのデータをダウンロードする</h3>
<p><code>gsutil</code> を使って、Storageのデータをダウンロードします。
保存先のフォルダはあらかじめ用意しておいてください。
ダウンロードファイルは複数あるので、専用のexport先フォルダを用意しておくのが無難です。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ gsutil -m cp -r gs://your-project-id.appspot.com/folder-name export-path
</code></pre></div><h2 id=データをインポートする>データをインポートする</h2>
<p>emulator起動時に、 <code>--import</code> オプションを追加することで、データをインポートして立ち上げてくれます。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>$ firebase emulators:start --import ./folder-name
</code></pre></div><h2 id=エクスポートされたデータの加工について>エクスポートされたデータの加工について</h2>
<p>エクスポートされたFirestoreはテキストファイルっぽいけど、そうではないバイナリファイルのような形式で出力されるので、テキストエディタでの加工はできません（注）。</p>
<p>そのためマスクデータを作成したい場合は、次の手段でやるのが無難かもしれません。</p>
<ul>
<li>一度エクスポートしたデータをそのままemulatorで読み込む</li>
<li>emulatorのコンソール画面から手動、またはAdmin SDKなどを利用したパッチで必要なデータをマスクする</li>
<li>マスクし終わったfirestoreのデータをexportする</li>
</ul>
<p>（注）下記の記事を読む限り、LevelDBログ形式というやつかもしれないので、何らかの手段で加工はできるかも。</p>
<p><a href="https://firebase.google.com/docs/firestore/manage-data/export-import?hl=ja#export_format_and_metadata_files">https://firebase.google.com/docs/firestore/manage-data/export-import?hl=ja#export_format_and_metadata_files</a></p>
<p>以上です。</p>
</div>
<div class=after-post-tags>
<ul class=tags>
<li>
<a href=/note/tags/tech>tech</a>&ensp;
</li>
<li>
<a href=/note/tags/firebase>firebase</a>&ensp;
</li>
</ul>
</div>
<div class="row PageNavigation d-flex justify-content-between font-weight-bold">
<a class="d-block col-md-6" href=https://yamacraft.github.io/note/memo-google-io-2021-list/> &#171; Google I/O 2021のアーカイブ視聴用メモ</a>
<a class="d-block col-md-6 text-lg-right" href=https://yamacraft.github.io/note/diet-21-1q-done/>2021年1Q 減量結果報告 &#187;</a>
<div class=clearfix></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="jumbotron2 fortags">
<div class="d-md-flex h-100">
<div class="col-md-4 transpdark2 align-self-center text-center h-100">
<div class="d-md-flex align-items-center justify-content-center h-100">
<h2 class="d-md-block d-none align-self-center py-1 font-weight-light">all <span class="d-none d-md-inline">→</span></h2>
</div>
</div>
<div class="col-md-8 p-5 align-self-center text-center">
<a class="mt-1 mb-1" href=/note/tags/android>android</a>
<a class="mt-1 mb-1" href=/note/tags/app_restore>app_restore</a>
<a class="mt-1 mb-1" href=/note/tags/blender>blender</a>
<a class="mt-1 mb-1" href=/note/tags/blog>blog</a>
<a class="mt-1 mb-1" href=/note/tags/ci>ci</a>
<a class="mt-1 mb-1" href=/note/tags/dabun>dabun</a>
<a class="mt-1 mb-1" href=/note/tags/diary>diary</a>
<a class="mt-1 mb-1" href=/note/tags/dic_restore>dic_restore</a>
<a class="mt-1 mb-1" href=/note/tags/docker>docker</a>
<a class="mt-1 mb-1" href=/note/tags/done-report>done-report</a>
<a class="mt-1 mb-1" href=/note/tags/easylauncher>easylauncher</a>
<a class="mt-1 mb-1" href=/note/tags/firebase>firebase</a>
<a class="mt-1 mb-1" href=/note/tags/github>github</a>
<a class="mt-1 mb-1" href=/note/tags/github-actions>github-actions</a>
<a class="mt-1 mb-1" href=/note/tags/googleio>googleio</a>
<a class="mt-1 mb-1" href=/note/tags/homete>homete</a>
<a class="mt-1 mb-1" href=/note/tags/hugo>hugo</a>
<a class="mt-1 mb-1" href=/note/tags/keiba>keiba</a>
<a class="mt-1 mb-1" href=/note/tags/notice>notice</a>
<a class="mt-1 mb-1" href=/note/tags/nuxt>nuxt</a>
<a class="mt-1 mb-1" href=/note/tags/pixel>pixel</a>
<a class="mt-1 mb-1" href=/note/tags/poem>poem</a>
<a class="mt-1 mb-1" href=/note/tags/study>study</a>
<a class="mt-1 mb-1" href=/note/tags/tech>tech</a>
<a class="mt-1 mb-1" href=/note/tags/tsubo>tsubo</a>
<a class="mt-1 mb-1" href=/note/tags/unity>unity</a>
<a class="mt-1 mb-1" href=/note/tags/work>work</a>
<a class="mt-1 mb-1" href=/note/tags/workout>workout</a>
<a class="mt-1 mb-1" href=/note/tags/yamadajirushi>yamadajirushi</a>
<a class="mt-1 mb-1" href=/note/tags/yodan>yodan</a>
</div>
</div>
</div>
<footer class=footer>
<div class=container>
<div class=row>
<div class="col-md-6 col-sm-6 text-center text-lg-left">
&copy; yamacraft 2021 · <a href=https://creativecommons.org/licenses/by/4.0/deed.ja>CC BY 4.0</a>
</div>
<div class="col-md-6 col-sm-6 text-center text-lg-right">
<a target=_blank rel=noopener href=https://www.wowthemes.net>Mediumish Theme</a> by WowThemes.net
</div>
</div>
</div>
</footer>
</div>
<script src=https://code.jquery.com/jquery-3.4.1.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js integrity=sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js integrity=sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM crossorigin=anonymous></script>
<script src=/note/js/mediumish.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-49508140-1','auto'),ga('send','pageview'))</script>
</body>
</html>